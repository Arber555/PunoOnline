<html>
    <head>
        <title>Chat</title>

         <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="../socket.io/socket.io.js"></script>
    </head>
    <body>
        <div id="userFormArea" class="row">
              <form id="userForm">
                  <div class="form-group">
                      <label>Enter Username</label>
                      <input class="form-control" id="username" />
                      <br/>
                      <input type="submit" class="btn btn-primary" value="Login" />
                  </div>
              </form>
          </div>

          <form id="meFolForm">
                <input id="meFol" />
                <input type="submit" class="btn btn-primary" value="fol" />
          </form>
         

         <div class="row">
            <div class="col-md-5">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <span class="glyphicon glyphicon-comment"></span> Chat
                        <!--<div class="btn-group pull-right">
                            <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
                                <span class="glyphicon glyphicon-chevron-down"></span>
                            </button>
                            <ul class="dropdown-menu slidedown">
                                <li><a href="#"><span class="glyphicon glyphicon-refresh">
                                </span>Refresh</a></li>
                                <li><a href="#"><span class="glyphicon glyphicon-ok-sign">
                                </span>Available</a></li>
                                <li><a href="#"><span class="glyphicon glyphicon-remove">
                                </span>Busy</a></li>
                                <li><a href="#"><span class="glyphicon glyphicon-time"></span>
                                    Away</a></li>
                                <li class="divider"></li>
                                <li><a href="#"><span class="glyphicon glyphicon-off"></span>
                                    Sign Out</a></li>
                            </ul>
                        </div>-->
                    </div>
                    <div class="panel-body">
                        <ul class="chat" id="chat-list">
                            <!--<li class="left clearfix"><span class="chat-img pull-left">
                                <img src="img/rtopalli.jpg" alt="User Avatar" width="45" height="55" class="img-circle" />
                            </span>
                                <div class="chat-body clearfix">
                                    <div class="header">
                                        <strong class="primary-font">Ragip Topalli</strong> <small class="pull-right text-muted">
                                            <span class="glyphicon glyphicon-time"></span>12 mins ago</small>
                                    </div>
                                    <p>
                                        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur bibendum ornare
                                        dolor, quis ullamcorper ligula sodales.
                                    </p>
                                </div>
                            </li>
                            <li class="right clearfix"><span class="chat-img pull-right">
                                <img src="img/profile.jpg" alt="User Avatar" width="45" height="55" class="img-circle" />
                            </span>
                                <div class="chat-body clearfix">
                                    <div class="header">
                                        <small class=" text-muted"><span class="glyphicon glyphicon-time"></span>13 mins ago</small>
                                        <strong class="pull-right primary-font">Arber Mulla</strong>
                                    </div>
                                    <p>
                                        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur bibendum ornare
                                        dolor, quis ullamcorper ligula sodales.
                                    </p>
                                </div>
                            </li>
                            <li class="left clearfix"><span class="chat-img pull-left">
                                <img src="img/rtopalli.jpg" alt="User Avatar" width="45" height="55" class="img-circle" />
                            </span>
                                <div class="chat-body clearfix">
                                    <div class="header">
                                        <strong class="primary-font">Ragip Topalli</strong> <small class="pull-right text-muted">
                                            <span class="glyphicon glyphicon-time"></span>14 mins ago</small>
                                    </div>
                                    <p>
                                        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur bibendum ornare
                                        dolor, quis ullamcorper ligula sodales.
                                    </p>
                                </div>
                            </li>
                            <li class="right clearfix"><span class="chat-img pull-right">
                                <img src="img/profile.jpg" alt="User Avatar" width="45" height="55" class="img-circle" />
                            </span>
                                <div class="chat-body clearfix">
                                    <div class="header">
                                        <small class=" text-muted"><span class="glyphicon glyphicon-time"></span>15 mins ago</small>
                                        <strong class="pull-right primary-font">Arber Mulla</strong>
                                    </div>
                                    <p>
                                        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur bibendum ornare
                                        dolor, quis ullamcorper ligula sodales.
                                    </p>
                                </div>
                            </li>-->
                        </ul>
                    </div>
                    <form id="messageForm">
                        <div class="panel-footer">
                            <div class="input-group">
                                <input id="btn-input" type="text" class="form-control input-sm" placeholder="Type your message here..." />
                                <span class="input-group-btn">
                                    <input type="submit" class="btn btn-warning btn-sm" id="btn-chat" value="Send Message" />
                                </span>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <script>
            var idU = null;
            function chatP(id){
                if(id){
                    //messageArea.show();
                    console.log("mrenda chat");
                    idU = id;
                    console.log(idU);
                }
            }
            $(function(){
                var socket = io.connect();
                var userFormArea = $("#userFormArea");
                var userForm = $("#userForm");
                var userListForm = $("#userListForm");
                //var users = $('#users');
                var username = $("#username");
                var chat = $("#chat");
                var messageForm = $("#messageForm");
                var message = $("#message");
                var userFormL = $('#userFormL');
                var messageArea = $('#messageArea');
                //
                var chatList = $('#chat-list');
                var meFolForma = $('#meFolForm');
                var meFol = $('meFol');

                userForm.submit(function(e){   //jasht perdorimit
                    e.preventDefault();
                    socket.emit('new user', username.val(), function(data){
                        /*if(data)
                        {
                            userFormArea.hide();
                            userListForm.show();
                        }*/
                    });
                    username.val('');
                });

                socket.on('usernames', function(data){ //jasht perdorimit per momentin
                    var html = '';

                    for(i = 0;i < data.length; i++)
                    {                                                                                           //"+data[i]+"
                        html += "<li class='list-group-item'><button type='button' id='"+data[i]+"' onclick='chatP(this.id)'>"+data[i]+"</button></li>";  
                    }

                    users.html(html);
                });


                userFormL.submit(function(e){  //me kond don me fol +permirsime duhet ... per momentin jasht perdorimit
                    e.preventDefault();

                    messageArea.show();
                    console.log(idU);
                });

                meFolForma.submit(function(e){
                    e.preventDefault();

                    console.log(meFol.val());
                });

                messageForm.submit(function(e){
                    e.preventDefault();
                    //socket.emit('send message', message.val());
                    socket.emit('send message', message.val(), idU, function(data){
                        chat.append('<p>'+data.nick+' : '+ data.msg +'</p>');
                        console.log("o ka hin me sa duket ???");
                    });
                // console.log(username);
                    chatList.append("<li class='left clearfix'><span class='chat-img pull-left'>"+
                            "</span>"+
                                "<div class='chat-body clearfix'>"+
                                    "<div class='header'>"+
                                        "<strong class='primary-font'>"+window.localStorage.getItem('username')+"</strong> <small class='pull-right text-muted'>"+
                                            "<span class='glyphicon glyphicon-time'></span>12 mins ago</small>"+
                                    "</div>"+
                                    "<p>"+message.val()+"</p>"+
                                "</div>"+
                            "</li>");

                    message.val('');
                });

                socket.on('whisper' ,function(data){
                    chat.append("<li class='left clearfix'><span class='chat-img pull-left'>"+
                            "</span>"+
                                "<div class='chat-body clearfix'>"+
                                    "<div class='header'>"+
                                        "<strong class='primary-font'>"+data.nick+"</strong> <small class='pull-right text-muted'>"+
                                            "<span class='glyphicon glyphicon-time'></span>12 mins ago</small>"+
                                    "</div>"+
                                    "<p>"+data.msg+"</p>"+
                                "</div>"+
                            "</li>");
                });
                /*idU.ready(function(){
                    console.log(idU);
                });
                /*idU.click(function(){
                    console.log("mrenda");
                    messageArea.show();
                });*/

                //codi vjeter
                /*var socket = io.connect();
                var messageForm = $("#messageForm");
                var message = $("#message");
                var chat = $("#chat");
                var messageArea = $("#messageArea");
                var userFormArea = $("#userFormArea");
                var userForm = $("#userForm");
                var users = $("#users");
                var username = $("#username");

                messageForm.submit(function(e){
                    e.preventDefault();
                    //socket.emit('send message', message.val());
                    socket.emit('private message', 'Arber', message.val());
                    message.val('');
                });

                socket.on('new message', function(data){
                    chat.append('<div class="well"><strong>'+ data.user +'</strong>:'+data.msg+'</div>');
                });

                userForm.submit(function(e){
                    e.preventDefault();
                    socket.emit('new user', username.val(), function(data){
                        if(data)
                        {
                            userFormArea.hide();
                            messageArea.show();
                        }
                    });
                    username.val('');
                });

                socket.on('get users', function(data){
                    var html = '';

                    for(i = 0;i < data.length; i++)
                    {
                        html += "<li class='list-group-item'>"+data[i]+"</li>"
                    }

                    users.html(html);
                });*/
            });
      </script>

    </body>
</html>